<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>üìä AiRi Portfolio Prices</title>
  <style>
    body { font-family: system-ui, Roboto, 'Apple SD Gothic Neo', sans-serif; margin: 24px; color: #222; }
    h2 { margin-bottom: 8px; }
    table { border-collapse: collapse; width: 100%; margin-top: 12px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
    th { background: #f8fafc; }
    td.t { text-align: left; }
    .pos { color: #0b875b; font-weight: bold; }
    .neg { color: #c0392b; font-weight: bold; }
    .muted { color: #6b7280; font-size: 14px; }
  </style>
</head>
<body>
  <h2>üìä Prices Table</h2>
  <div class="muted">Îç∞Ïù¥ÌÑ∞ Í∏∞Ï§Ä ÏãúÍ∞Å: <span id="asof">-</span> (10Î∂ÑÎßàÎã§ ÏûêÎèô Í∞±Ïã†)</div>
  <table>
    <thead>
      <tr><th class="t">Ticker</th><th>Close</th><th>Prev</th><th>Œî%</th><th>MarketCap</th><th>Volume</th></tr>
    </thead>
    <tbody id="prices-tbody"><tr><td colspan="6">Î°úÎî© Ï§ë...</td></tr></tbody>
  </table>

  <script>
  async function loadPrices() {
    try {
      const res = await fetch('/prices_table-data');
      const data = await res.json();
      const tbody = document.getElementById('prices-tbody');
      tbody.innerHTML = '';
      for (const r of data.rows) {
        const tr = document.createElement('tr');
        const chg = r.change_pct;
        tr.innerHTML = `
          <td class="t">${r.ticker ?? '-'}</td>
          <td>${r.close?.toLocaleString(undefined,{maximumFractionDigits:2}) ?? '-'}</td>
          <td>${r.prev_close?.toLocaleString(undefined,{maximumFractionDigits:2}) ?? '-'}</td>
          <td class="${chg==null?'':(chg>=0?'pos':'neg')}">${chg==null?'-':(chg>0?'+':'')+chg.toFixed(2)+'%'}</td>
          <td>${r.marketcap==null?'-':r.marketcap.toLocaleString()}</td>
          <td>${r.volume==null?'-':r.volume.toLocaleString()}</td>
        `;
        tbody.appendChild(tr);
      }
      document.getElementById('asof').textContent = new Date(data.asof_utc).toLocaleString();
    } catch (e) {
      console.error('fetch error', e);
    }
  }
  loadPrices();
  setInterval(loadPrices, 10*60*1000);
  </script>
</body>
</html>
